<%
function linkInDiv(url) {
  if (!url) return ''
  return `<div class="url row"><a href="${url}">${fn.noSchemaURL(url)}</a></div>`
}
%>

<!-- Basics -->
<section class="basics-section">
  <h1><%= cv.basics.name %></h1>
  <% if (cv.basics.label) { %>
    <div class="label row"><%= cv.basics.label %></div>
  <% } %>
  <%- linkInDiv(cv.basics.url) %>
  <% if (cv.basics.summary) { %>
    <div class="summary"><%= cv.basics.summary %></div>
  <% } %>
  <div class="contact row">
    <% if (cv.basics.email) { %>
      <div class="item">
        <%- fn.getIconSVG('mdi:email') %>
        <span><a href="mailto:<%= cv.basics.email %>"><%= cv.basics.email %></a></span>
      </div>
    <% } %>
    <% if (cv.basics.phone) { %>
      <div class="item">
        <%- fn.getIconSVG('mdi:phone') %>
        <span><%= cv.basics.phone %></span>
      </div>
    <% } %>
    <% if (cv.basics.location) { %>
      <div class="item">
        <%- fn.getIconSVG('mdi:location') %>
        <span><%= cv.basics.location.city %>, <%= cv.basics.location.countryCode %></span>
      </div>
    <% } %>
  </div>
</section>


<%
function dateRange(item, level) {
  let {startDate, endDate} = item
  if (!startDate && !endDate) return ''
  let format
  // level: 1: year, 2: month, 3: day
  switch (level) {
    case 1:
      format = 'YYYY'
      break;
    case 2:
      format = 'MMM YYYY'
      break;
  }
  if (format) {
    startDate = startDate ? fn.reformatDate(startDate, format) : ''
    endDate = endDate ? fn.reformatDate(endDate, format) : ''
  }
  let result = ''
  if (startDate && endDate) {
    result = `${startDate} â€“ ${endDate}`
  } else if (startDate) {
    result = `Since ${startDate}`
  } else if (endDate) {
    result = `Until ${endDate}`
  }
  return `<div class="date-range">${result}</div>`
}
%>

<!-- Educations -->
<% if (cv.education) { %>
<section class="education-section">
  <div class="section-title">
    <h2>Educations</h2>
    <div class="line"></div>
  </div>
  <% for (const item of cv.education) { %>
    <div class="education section-item">
      <div class="row space-between">
        <h3><%= item.institution %></h3>
        <%- dateRange(item, 2) %>
      </div>
      <div class="study row fz-4">
        <%= item.studyType %>, <%= item.area %>
      </div>
      <div class="score row">Overall GPA: <%= item.score %></div>
      <% if (item.courses && item.courses.length > 0) { %>
        <div class="courses row">
          Courses: <%= item.courses.join('; ') %>
        </div>
      <% } %>
      <%- linkInDiv(item.url) %>
    </div>
  <% } %>
</section>
<% } %>

<!-- Work -->
<% if (cv.work) { %>
<section class="work-section">
  <div class="section-title">
    <h2>Work</h2>
    <div class="line"></div>
  </div>
  <% for (const item of cv.work) { %>
    <div class="work section-item">
      <div class="row space-between">
        <h3><%= item.name %></h3>
        <%- dateRange(item, 2) %>
      </div>
      <div class="position row fz-4"><%= item.position %></div>
      <div class="summary row"><%= item.summary %></div>
      <% if (item.highlights && item.highlights.length > 0) { %>
        <div class="highlights row">
          <ul>
          <% for (const hl of item.highlights) { %>
            <li><%= hl %></li>
          <% } %>
          </ul>
        </div>
      <% } %>
      <%- linkInDiv(item.url) %>
    </div>
  <% } %>
</section>
<% } %>

<!-- Projects -->
<% if (cv.projects) { %>
<section class="projects-section">
  <div class="section-title">
    <h2>Projects</h2>
    <div class="line"></div>
  </div>
  <% for (const item of cv.projects) { %>
    <div class="project section-item">
      <div class="row space-between">
        <h3><%= item.name %></h3>
        <%- dateRange(item, 2) %>
      </div>
      <div class="row lh-para"><%= item.description %></div>
      <% if (item.highlights && item.highlights.length > 0) { %>
        <div class="highlights row">
          <ul>
          <% for (const hl of item.highlights) { %>
            <li><%= hl %></li>
          <% } %>
          </ul>
        </div>
      <% } %>
      <div class="keywords row">
        <% for (const kw of item.keywords) { %>
          <span class="item"><%= kw %></span>
        <% } %>
      </div>
      <%- linkInDiv(item.url) %>
    </div>
  <% } %>
</section>
<% } %>

<!-- Side-projects -->
<% if (cv.sideProjects) { %>
<section class="sideprojects-section">
  <div class="section-title">
    <h2>Side-projects</h2>
    <div class="line"></div>
  </div>
  <% for (const item of cv.sideProjects) { %>
    <div class="sideproject section-item">
      <div class="row space-between">
        <h3><%= item.name %></h3>
        <%- dateRange(item, 1) %>
      </div>
      <div class="description row lh-para"><%= item.description %></div>
      <% if (item.keywords && item.keywords.length > 0) { %>
        <div class="keywords row">
          <% for (const kw of item.keywords) { %>
            <span class="item"><%= kw %></span>
          <% } %>
        </div>
      <% } %>
      <%- linkInDiv(item.url) %>
    </div>
  <% } %>
</section>
<% } %>

<!-- Skills -->
<% if (cv.skills) { %>
<section class="skills-section">
  <div class="section-title">
    <h2>Skills</h2>
    <div class="line"></div>
  </div>
  <div class="two-columns">
  <% for (const item of cv.skills) { %>
    <div class="skill section-item">
      <h3><%= item.name %></h3>
      <div class="level row"><%= item.level %></div>
      <% if (item.keywords && item.keywords.length > 0) { %>
        <div class="keywords">
          <% for (const kw of item.keywords) { %>
            <span class="item"><%= kw %></span>
          <% } %>
        </div>
      <% } %>
    </div>
  <% } %>
  </div>
</section>
<% } %>

<!-- Languages -->
<% if (cv.languages) { %>
<section class="languages-section page-unit">
  <div class="section-title">
    <h2>Languages</h2>
    <div class="line"></div>
  </div>
  <% for (const item of cv.languages) { %>
    <div class="language section-item">
      <h3><%= item.language %></h3>
      <div class="fluency row lh-para"><%= item.fluency %></div>
    </div>
  <% } %>
</section>
<% } %>


<!-- TODO: -->
<!-- Awards -->
<!-- Volunteer -->
<!-- Publications -->
<!-- References -->
<!-- Interests -->

<!-- meta -->
<% if (cv.meta) { %>
<footer>
  <% if (cv.meta.version) { %>
    <div class="version">Version: <%= cv.meta.version %></div>
  <% } %>
  <% if (cv.meta.lastModified) { %>
    <div class="version">Last modified: <%= cv.meta.lastModified %></div>
  <% } %>
</footer>
<% } %>
